<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Quality Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.heat/dist/leaflet-heat.css" />
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        #map { height: 100vh; }
        .legend { background-color: white; padding: 10px; border-radius: 5px; font-size: 12px; }
        .legend div { margin-bottom: 5px; }
        .toggle-btn { position: absolute; top: 10px; left: 10px; z-index: 1000; background-color: #fff; border: 1px solid #ccc; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="pm25-overlay-toggle" class="toggle-btn">Toggle PM₂.₅ Overlay</button>
    <button id="tempo-overlay-toggle" class="toggle-btn" style="top: 40px;">Toggle TEMPO NO₂ Overlay</button>
    <div id="legend" class="legend" style="top: 70px; position: absolute;"></div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([43.6532, -79.3832], 10); // Centered on Toronto

        // Add a base layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // Initialize overlay variables
        let pm25OverlayEnabled = false, tempoOverlayEnabled = false;
        let pm25HeatmapLayer = null, tempoHeatmapLayer = null;

        // Function to fetch PM₂.₅ data
        async function fetchPM25Data() {
            // Replace with actual PM₂.₅ data fetching logic
            return [
                { lat: 43.7, lon: -79.42, value: 35 },
                { lat: 43.8, lon: -79.43, value: 50 },
                { lat: 43.9, lon: -79.44, value: 60 },
                // Add more data points as needed
            ];
        }

        // Function to update PM₂.₅ overlay
        async function updatePM25Overlay() {
            if (!pm25OverlayEnabled) return;
            if (pm25HeatmapLayer) map.removeLayer(pm25HeatmapLayer);

            const data = await fetchPM25Data();
            const points = data.map(d => [d.lat, d.lon, d.value]);

            pm25HeatmapLayer = L.heatLayer(points, {
                radius: 25,
                blur: 15,
                maxZoom: 17,
                gradient: {
                    0.2: '#2ECC40',
                    0.4: '#FFDC00',
                    0.6: '#FF851B',
                    0.8: '#FF4136',
                    1.0: '#800000'
                }
            }).addTo(map);
        }

        // Function to fetch TEMPO NO₂ data
        async function fetchTEMPOData() {
            // Replace with actual TEMPO NO₂ data fetching logic
            return [
                { lat: 43.7, lon: -79.42, value: 0.5 },
                { lat: 43.8, lon: -79.43, value: 0.7 },
                { lat: 43.9, lon: -79.44, value: 0.9 },
                // Add more data points as needed
            ];
        }

        // Function to update TEMPO NO₂ overlay
        async function updateTEMPOOverlay() {
            if (!tempoOverlayEnabled) return;
            if (tempoHeatmapLayer) map.removeLayer(tempoHeatmapLayer);

            const data = await fetchTEMPOData();
            const points = data.map(d => [d.lat, d.lon, d.value]);

            tempoHeatmapLayer = L.heatLayer(points, {
                radius: 25,
                blur: 15,
                maxZoom: 17,
                gradient: {
                    0.2: '#2ECC40',
                    0.4: '#FFDC00',
                    0.6: '#FF851B',
                    0.8: '#FF4136',
                    1.0: '#800000'
                }
            }).addTo(map);
        }

        // Toggle PM₂.₅ overlay
        document.getElementById('pm25-overlay-toggle').addEventListener('click', async () => {
            pm25OverlayEnabled = !pm25OverlayEnabled;
            if (pm25OverlayEnabled) {
                await updatePM25Overlay();
            } else if (pm25HeatmapLayer) {
                map.removeLayer(pm25HeatmapLayer);
            }
        });

        // Toggle TEMPO NO₂ overlay
        document.getElementById('tempo-overlay-toggle').addEventListener('click', async () => {
            tempoOverlayEnabled = !tempoOverlayEnabled;
            if (tempoOverlayEnabled) {
                await updateTEMPOOverlay();
            } else if (tempoHeatmapLayer) {
                map.removeLayer(tempoHeatmapLayer);
            }
        });

        // Update overlays on map move
        map.on('moveend', () => {
            if (pm25OverlayEnabled) {
                updatePM25Overlay();
            }
            if (tempoOverlayEnabled) {
                updateTEMPOOverlay();
            }
        });

        // Initialize legend
        function updateLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = `
                <div><strong>PM₂.₅ Concentration (µg/m³)</strong></div>
                <div>0 - 35: Good</div>
                <div>36 - 55: Moderate</div>
                <div>56 - 150: Unhealthy for Sensitive Groups</div>
                <div>151 - 250: Unhealthy</div>
                <div>251 - 350: Very Unhealthy</div>
                <div>351 - 500: Hazardous</div>
            `;
        }
        updateLegend();
    </script>
</body>
</html>
